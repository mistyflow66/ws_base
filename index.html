<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>ç…¦é¡˜æ°‘å®¿ï½œæ™ºæ…§å·¥ä½œç«™</title>
  <style>
    /* --- å…¨åŸŸæ¨£å¼ --- */
    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }      
    body { font-family: 'PingFang TC', 'Microsoft JhengHei', sans-serif; background: #f0f2f5; margin: 0; color: #333; }      
    .container { max-width: 500px; margin: auto; background: #fff; min-height: 100vh; display: flex; flex-direction: column; }      

    /* --- å°è¦½åˆ— --- */
    .nav-tabs { display: flex; padding: 10px; background: #fff; border-bottom: 1px solid #eee; position: sticky; top: 0; z-index: 1000; }
    .tab-btn { flex: 1; padding: 12px; border: none; background: #f8f9fa; cursor: pointer; font-size: 0.95rem; font-weight: bold; color: #7f8c8d; }
    .tab-btn.active { background: #27ae60; color: white; border-radius: 8px; }

    .content { padding: 15px; flex-grow: 1; }
    .page { display: none; }
    .page.active { display: block; }

    /* --- å¡ç‰‡èˆ‡è¼¸å…¥æ¡† --- */
    .card { background: #fff; border: 1px solid #eef0f2; border-radius: 12px; padding: 15px; margin-bottom: 15px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); position: relative; }
    h3 { font-size: 1rem; margin: 0 0 10px 0; color: #2c3e50; border-left: 4px solid #27ae60; padding-left: 10px; }
    input, select { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 1rem; margin-bottom: 10px; }
    
    .copy-btn { background: #3498db; color: white; border: none; padding: 12px; border-radius: 8px; width: 100%; font-weight: bold; margin-top: 8px; cursor: pointer; font-size: 1rem; }
    .preview-area { background: #f9fafb; padding: 12px; border-radius: 8px; font-size: 0.85rem; white-space: pre-wrap; border: 1px solid #eee; line-height: 1.6; }
    
    /* --- æ‰“åŒ…é€šçŸ¥å°ˆç”¨ --- */
    .pkg-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px; background: #fcfcfc; padding: 10px; border-radius: 8px; border: 1px dashed #ccc; }
    .pkg-grid label { display: flex; align-items: center; gap: 8px; font-size: 0.9rem; font-weight: bold; color: #444; cursor: pointer; }

    /* --- å ±åƒ¹ç¥å™¨æ ¼ç·š --- */
    .price-grid { display: grid; grid-template-columns: 1.2fr 1fr 1.5fr; gap: 8px; align-items: center; margin-bottom: 10px; font-size: 0.85rem; }
    .highlight { color: #e74c3c; font-size: 1.1rem; font-weight: bold; }
    .private-price { color: #27ae60; font-size: 1.4rem; font-weight: 800; border-top: 1px dashed #ddd; padding-top: 10px; margin-top: 10px; }

    /* --- æ‘ºç–Šé¸å–® --- */
    .accordion-header { background: #fff9e6; border: 1px solid #ffeaa7; padding: 12px; border-radius: 12px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
    .accordion-content { display: none; background: #fff; border: 1px solid #ffeaa7; padding: 15px; border-radius: 0 0 12px 12px; margin-top: -15px; margin-bottom: 15px; }
    .accordion-content.active { display: block; }

    /* --- æœˆæ›† --- */
    .calendar-container { display: grid; grid-template-columns: repeat(7, 1fr); gap: 4px; margin-top: 15px; }
    .cal-day { aspect-ratio: 1/1; display: flex; align-items: center; justify-content: center; font-size: 0.8rem; border-radius: 6px; background: #f8f9fa; color: #aaa; }
    .cal-header { font-weight: bold; color: #2c3e50; background: #eee; }
    .cal-day.has-order { background: #27ae60; color: white; font-weight: bold; cursor: pointer; }

    /* --- æ•¸æ“šé¡¯ç¤º --- */
    .stats-hidden { display: none; }
    .stats-active { display: block; background: #f0f7ff; padding: 15px; border-radius: 12px; margin-top: 10px; }

    /* --- å½ˆå‡ºå±¤ --- */
    .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); display: none; z-index: 2000; }
    .modal-content { background: white; margin: 15% auto; padding: 25px; width: 85%; border-radius: 16px; position: relative; }
    
    .loading-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255,255,255,0.8); z-index: 9999; display: none; flex-direction: column; align-items: center; justify-content: center; }
    .spinner { width: 40px; height: 40px; border: 4px solid #f3f3f3; border-top: 4px solid #27ae60; border-radius: 50%; animation: spin 1s linear infinite; }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
  </style>
</head>
<body>

<div class="container">
  <div class="nav-tabs">
    <button class="tab-btn active" onclick="switchPage('tpl-page', event)">å›è¦†æ¨¡æ¿</button>
    <button class="tab-btn" onclick="switchPage('order-page', event)">è¨‚å–®ç®¡ç†</button>
    <button class="tab-btn" onclick="switchPage('calc-page', event)">å ±åƒ¹ç¥å™¨</button>
  </div>

  <div class="content">
    
    <div id="tpl-page" class="page active">
      <div class="card" style="background: #eef7ff;">
        <h3>å¿«é€Ÿè®Šæ•¸è¨­å®š</h3>
        <input type="text" id="v-date" placeholder="å…¥ä½æ—¥æœŸ (ä¾‹: 12/25)" oninput="updateAll()">
        <input type="text" id="v-pwd" placeholder="ä»Šæ—¥å¤§é–€å¯†ç¢¼" oninput="updateAll()">
        <input type="number" id="v-dep" placeholder="éœ€åŒ¯è¨‚é‡‘é‡‘é¡" oninput="updateAll()">
      </div>

      <div class="accordion-header" onclick="toggleAccordion('pkg-content', 'pkg-icon')">
        <span class="acc-title">ğŸ å…¥ä½æ‰“åŒ…é€šçŸ¥ (å‹¾é¸è‡ªå‹•çµ„åˆ)</span>
        <span id="pkg-icon">â–¼</span>
      </div>
      <div id="pkg-content" class="accordion-content">
        <div class="pkg-grid">
          <label><input type="checkbox" id="c-basic" checked onchange="buildPackage()"> å¯†ç¢¼é‘°åŒ™</label>
          <label><input type="checkbox" id="c-sing" checked onchange="buildPackage()"> å”±æ­Œæ•™å­¸</label>
          <label><input type="checkbox" id="c-spot" checked onchange="buildPackage()"> æ™¯é»ç†±ç‚’</label>
          <label><input type="checkbox" id="c-warn" checked onchange="buildPackage()"> æº«é¦¨æé†’</label>
        </div>
        <div class="preview-area" id="pkg-preview"></div>
        <button class="copy-btn" style="background:#f39c12" onclick="copyText('pkg-preview', event)">è¤‡è£½æ‰“åŒ…è¨Šæ¯</button>
      </div>

      <div id="tpl-list"></div>
    </div>

    <div id="order-page" class="page">
      <div id="lock-screen">
        <div class="card">
          <h3>èº«åˆ†é©—è­‰</h3>
          <input type="password" id="admin-key" placeholder="è«‹è¼¸å…¥ç®¡ç†é‡‘é‘°">
          <button class="copy-btn" onclick="fetchOrders()">ç™»å…¥åŒæ­¥è¨‚å–®</button>
        </div>
      </div>

      <div id="order-content" style="display:none;">
        <div class="card">
            <div style="display:flex; justify-content: space-between; align-items:center; margin-bottom:10px;">
                <button onclick="changeMonth(-1)">â—€</button>
                <b id="cal-month-title"></b>
                <button onclick="changeMonth(1)">â–¶</button>
            </div>
            <div id="calendar-grid" class="calendar-container"></div>
        </div>
        
        <button class="copy-btn" style="background:#8e44ad" onclick="toggleStats()">ğŸ“Š æŸ¥çœ‹ç¶“ç‡Ÿæ•¸æ“š</button>
        <div id="stats-area" class="stats-hidden">
            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px; margin-top:10px;">
                <div class="card" style="text-align:center; padding:10px; margin:0;">
                    <small>æœ¬æœˆç¸½äººæ•¸</small><br><b id="stat-total-guests" style="font-size:1.2rem; color:#27ae60;">0</b>
                </div>
                <div class="card" style="text-align:center; padding:10px; margin:0;">
                    <small>Booking ä½”æ¯”</small><br><b id="stat-b-rate" style="font-size:1.2rem; color:#e67e22;">0%</b>
                </div>
            </div>
        </div>

        <div class="accordion-header" style="margin-top:20px; background:#fdf2f2;" onclick="toggleAccordion('add-order-form', 'add-icon')">
            <span class="acc-title" style="color:#c0392b;">â• æ‰‹å‹•æ–°å¢è¨‚å–®</span>
            <span id="add-icon">â–¼</span>
        </div>
        <div id="add-order-form" class="accordion-content">
            <input type="text" id="o-name" placeholder="æˆ¿å®¢å§“å">
            <input type="date" id="o-date">
            <select id="o-source">
                <option value="LINE">LINE (ç§è¨Š)</option>
                <option value="Booking">Booking.com</option>
            </select>
            <input type="number" id="o-guests" placeholder="ç¸½äººæ•¸">
            <input type="number" id="o-total" placeholder="ç¸½æˆ¿åƒ¹">
            <input type="number" id="o-dep" placeholder="è¨‚é‡‘">
            <button class="copy-btn" style="background:#27ae60" onclick="addOrder()">å„²å­˜è¨‚å–®åˆ° Google è©¦ç®—è¡¨</button>
        </div>
      </div>
    </div>

    <div id="calc-page" class="page">
      <div class="card">
        <h3>ç§è¨Šå„ªæƒ å ±åƒ¹ç¥å™¨</h3>
        <select id="m-season" onchange="updateAll()">
          <option value="weekday">å¹³æ—¥ (é€±ä¸€è‡³é€±å››)</option>
          <option value="weekend">å‡æ—¥ (äº”å…­æ—¥ / æš‘å‡)</option>
          <option value="cny">å®šåƒ¹ (æ˜¥ç¯€)</option>
        </select>
        
        <div class="price-grid" style="font-weight:bold; border-bottom:1px solid #eee; padding-bottom:5px;">
            <span>æˆ¿é–“</span><span>äººæ•¸(åºŠ)</span><span>æ‰‹å‹•æ”¹åƒ¹(é¸å¡«)</span>
        </div>
        <div class="price-grid">
            <span>201 (2äºº)</span>
            <input type="number" id="m-201" value="0" oninput="runManualCalc()" style="margin:0;">
            <input type="number" id="p-201" placeholder="1900" oninput="runManualCalc()" style="margin:0;">
        </div>
        <div class="price-grid">
            <span>202 (2-4äºº)</span>
            <input type="number" id="m-202" value="0" oninput="runManualCalc()" style="margin:0;">
            <input type="number" id="p-202" placeholder="2400" oninput="runManualCalc()" style="margin:0;">
        </div>
        <div class="price-grid">
            <span>301 (2-6äºº)</span>
            <input type="number" id="m-301" value="0" oninput="runManualCalc()" style="margin:0;">
            <input type="number" id="p-301" placeholder="3500" oninput="runManualCalc()" style="margin:0;">
        </div>
        <div id="calc-result"></div>
      </div>
    </div>

  </div>
</div>

<div id="order-modal" class="modal" onclick="closeModal(event)">
    <div class="modal-content">
        <span onclick="closeModal()" style="position:absolute; right:15px; top:10px; cursor:pointer; font-size:24px;">Ã—</span>
        <div id="modal-body"></div>
    </div>
</div>

<div id="loading-overlay" class="loading-overlay">
    <div class="spinner"></div>
    <p>è³‡æ–™è™•ç†ä¸­...</p>
</div>

<script>
// --- åŸºæœ¬è¨­å®š ---
const GAS_URL = "https://script.google.com/macros/s/AKfycbySPYLiPf6pUhZqbHMSK2z2eYtrzVWrPUweojAoCG8_15IrxQH0dhTOiXp1gf58dpiEQg/exec"; 

const PRICE_MAP = {      
  '201': { weekday: { 1: 1900 }, weekend: { 1: 2200 }, cny: { 1: 2900 } },      
  '202': { weekday: { 1: 2400, 2: 2600 }, weekend: { 1: 2600, 2: 2800 }, cny: { 1: 5600, 2: 6000 } },      
  '301': { weekday: { 1: 3500, 2: 4500, 3: 5000, 4: 5500 }, weekend: { 1: 3800, 2: 4800, 3: 5300, 4: 5800 }, cny: { 1: 6000, 2: 7000, 3: 8000, 4: 9000 } }      
};

const PKG_TEXT = {
  basic: (p) => `ğŸŒŸä»Šæ—¥å¤§é–€å¯†ç¢¼ï¼š${p}\nğŸ”“é–‹é–€æ–¹æ³•ï¼š\nï¼ˆ1ï¼‰å¾å¤–é–‹é–€ï¼šæ‰‹æŒè§¸ç¢°è¢å¹•äº®èµ·å¾Œè¼¸å…¥å¯†ç¢¼æŒ‰*å­—éµ\nï¼ˆ2ï¼‰å¾è£¡é¢å‡ºå»ï¼šæŒ‰ä¸‹å®‰å…¨éˆ•ã€æ‰‹æŠŠåŒæ™‚ä¸‹å£“å³å¯é–‹é–€\nğŸ”‘æˆ¿é–“é‘°åŒ™é…å‚™åœ¨é›»è¦–æ«ƒæ—é‘°åŒ™æ¶ï¼Œæ­¡è¿ä½¿ç”¨ã€‚éš”å¤©11é»é€€æˆ¿æ™‚ï¼Œé‘°åŒ™æ”¾å›æ¶ä¸Šå³å®Œæˆæ‰‹çºŒã€‚\nğŸš­æ°‘å®¿å®¤å…§å…¨é¢ç¦è¸ï¼Œè‹¥æœ‰éœ€è¦å¸è¸çš„æœ‹å‹ï¼Œæˆ‘å€‘æ¯å€‹é™½å°å’Œè»Šåº«éƒ½å‚™æœ‰ç…™ç°ç¼¸ï¼Œè¬è¬æ‚¨ğŸ™`,
  sing: () => `ğŸ¤è—ç‰™éº¥å…‹é¢¨éŸ³éŸ¿ä½¿ç”¨èªªæ˜ï¼š\nhttps://m.youtube.com/shorts/8LMhA15R870\n(è«‹æ–¼22:00å‰çµæŸå”±æ­Œï¼Œå¾ŒçºŒå¯æ”¹ç©é›»å‹•éº»å°‡åŒæ¨‚å–”ï¼)\n(è«‹æ–¼ 22:00 å‰çµæŸå”±æ­Œï¼Œå¾ŒçºŒå¯æ”¹ç©é›»å‹•éº»å°‡å–”ï¼)`,
  spot: () => `ğŸ±ç¾é£Ÿæ¨è–¦ï¼šé˜¿ä¿¡å¿«ç‚’ï¼ˆå ±ã€Œç…¦é¡˜æ°‘å®¿ã€äº« 9.5 æŠ˜å„ªæƒ ï¼‰\nğŸš—ç”Ÿæ´»æ©Ÿèƒ½ï¼š\n7-11(æ­¥è¡Œ5åˆ†)ï¼šhttps://maps.app.goo.gl/uskg6orv7dVas2eb7\nç¾è¯ç¤¾ï¼šhttps://maps.app.goo.gl/LNYRJGaVaj8GNxAy7\n\nåˆ†äº«å¾ˆä¸éŒ¯çš„æ­¥é“çµ¦æ‚¨åƒè€ƒï¼š\nä»å±±æ­¥é“ï¼šhttps://maps.app.goo.gl/C9XisDS8qaQax11q6\nä¸‰æ¸…å®®æ­¥é“ï¼šhttps://maps.app.goo.gl/rmyyNfcdFHc8YdbX6\næ¨è–¦æ­¥é“(ä»å±±æ­¥é“)ï¼šhttps://maps.app.goo.gl/C9XisDS8qaQax11q6\nä¸‰æ¸…å®®æ­¥é“ï¼šhttps://maps.app.goo.gl/rmyyNfcdFHc8YdbX6\nğŸŒ³å‘¨é‚Šï¼šé™„è¿‘æœ‰è½ç¾½æ¾æ­¥é“èˆ‡ç¾å»‰ç¤¾ï¼Œæ­¡è¿æ•£æ­¥æ¢ç´¢ã€‚`,
  warn: () => `ğŸ¢æº«é¦¨æé†’ï¼š\n1. æˆ¶å¤–çƒ¤è‚‰æ´»å‹•è«‹æ–¼ 21:00 å‰çµæŸï¼Œç¶­è­·é„°é‡Œå®‰å¯§ã€‚\n2. æ°‘å®¿æ‹–é‹çš†ç¶“éæ¸…æ´—ï¼Œè«‹æ”¾å¿ƒä½¿ç”¨ã€‚ç‚ºéŸ¿æ‡‰ç’°ä¿ï¼Œæˆ‘å€‘ä¸ä¸»å‹•æä¾›ä¸€æ¬¡æ€§ç‰™åˆ·ç‰™è†ï¼Œè‹¥å¿˜è¨˜æ”œå¸¶è«‹å‘ŠçŸ¥ã€‚`
};

let globalOrderData = [];
let currentViewDate = new Date();

// --- é‚è¼¯åŠŸèƒ½ ---

function switchPage(id, e) {
    document.querySelectorAll('.page, .tab-btn').forEach(el => el.classList.remove('active'));
    document.getElementById(id).classList.add('active');
    if(e) e.currentTarget.classList.add('active');
}

function updateAll() { 
    updatePlaceholders();
    buildPackage(); 
    runManualCalc(); 
}

function updatePlaceholders() {
    const s = document.getElementById('m-season').value;
    document.getElementById('p-201').placeholder = PRICE_MAP['201'][s][1];
    document.getElementById('p-202').placeholder = PRICE_MAP['202'][s][1];
    document.getElementById('p-301').placeholder = PRICE_MAP['301'][s][1];
}

function toggleAccordion(contentId, iconId) {
    const c = document.getElementById(contentId);
    c.classList.toggle('active');
    document.getElementById(iconId).innerText = c.classList.contains('active') ? 'â–²' : 'â–¼';
}

function buildPackage() {
    const d = document.getElementById('v-date').value || "ä»Šå¤©";
    const p = document.getElementById('v-pwd').value || "____";
    let pkg = `ğŸ‘‹ æ‚¨å¥½ï¼ç…¦é¡˜å°å¹«æ‰‹å½™æ•´æ‚¨çš„å…¥ä½è³‡è¨Š (${d})ï¼š\n\n`;
    
    if(document.getElementById('c-basic').checked) pkg += PKG_TEXT.basic(p) + `\n----------------\n`;
    if(document.getElementById('c-sing').checked) pkg += PKG_TEXT.sing() + `\n----------------\n`;
    if(document.getElementById('c-spot').checked) pkg += PKG_TEXT.spot() + `\n----------------\n`;
    if(document.getElementById('c-warn').checked) pkg += PKG_TEXT.warn() + `\n----------------\n`;
    
    pkg += `ç¥æ‚¨å…¥ä½æ„‰å¿«ï¼â˜ºï¸`;
    document.getElementById('pkg-preview').innerText = pkg;
}

function runManualCalc() {
    const s = document.getElementById('m-season').value;
    const rooms = ['201','202','301'];
    let totalBT = 0;
    rooms.forEach(rid => {
        const beds = parseInt(document.getElementById('m-'+rid).value);
        if(beds > 0) {
            const custom = parseFloat(document.getElementById('p-'+rid).value);
            totalBT += (custom > 0) ? custom : (PRICE_MAP[rid][s][beds] || PRICE_MAP[rid][s][1]);
        }
    });
    const priv = Math.ceil((totalBT * 0.88 * 1.03) / 10) * 10;
    document.getElementById('calc-result').innerHTML = `
        <div class="card">
            <div class="highlight">Booking ç¸½åƒ¹åƒè€ƒï¼š$${totalBT.toLocaleString()}</div>
            <div class="private-price">ç§è¨Šå„ªæƒ å ±åƒ¹ï¼š$${priv.toLocaleString()}</div>
            <div class="preview-area" id="p-res">ğŸ‘‹æ‚¨å¥½ï½ç…¦é¡˜æ°‘å®¿è©²æ—¥æœŸæœ‰ç©ºæˆ¿ï¼Œç§è¨Šè¨‚æˆ¿å„ªæƒ åƒ¹ï¼š$${priv.toLocaleString()}</div>
            <button class="copy-btn" onclick="copyText('p-res', event)">è¤‡è£½å ±åƒ¹è¨Šæ¯</button>
        </div>`;
}

async function fetchOrders() {
    const key = document.getElementById('admin-key').value;
    document.getElementById('loading-overlay').style.display = 'flex';
    try {
        const res = await fetch(GAS_URL, { method: "POST", body: JSON.stringify({ action: "read", key: key }) });
        globalOrderData = await res.json();
        document.getElementById('lock-screen').style.display = 'none';
        document.getElementById('order-content').style.display = 'block';
        renderOrderList();
    } catch(e) { alert("é©—è­‰é‡‘é‘°å¤±æ•—ï¼Œè«‹é‡æ–°è¼¸å…¥"); }
    finally { document.getElementById('loading-overlay').style.display = 'none'; }
}

async function addOrder() {
    const key = document.getElementById('admin-key').value;
    const data = {
        action: "add", key: key,
        name: document.getElementById('o-name').value, date: document.getElementById('o-date').value,
        source: document.getElementById('o-source').value, guests: document.getElementById('o-guests').value,
        total: document.getElementById('o-total').value, dep: document.getElementById('o-dep').value,
        bal: document.getElementById('o-total').value - document.getElementById('o-dep').value
    };
    if(!data.name || !data.date) return alert("è«‹è‡³å°‘å¡«å¯«æˆ¿å®¢å§“åèˆ‡æ—¥æœŸ");
    document.getElementById('loading-overlay').style.display = 'flex';
    try {
        await fetch(GAS_URL, { method: "POST", body: JSON.stringify(data) });
        alert("è¨‚å–®å·²æˆåŠŸå¯«å…¥è©¦ç®—è¡¨ï¼"); fetchOrders();
    } catch(e) { alert("å„²å­˜å¤±æ•—"); }
    finally { document.getElementById('loading-overlay').style.display = 'none'; }
}

function renderOrderList() {
    const year = currentViewDate.getFullYear();
    const month = currentViewDate.getMonth();
    document.getElementById('cal-month-title').innerText = `${year}å¹´ ${month + 1}æœˆ`;
    const mData = globalOrderData.filter(r => r[3] && r[3].includes(`${year}-${String(month+1).padStart(2,'0')}`));
    renderCalendar(year, month, mData);
    updateStatistics(mData);
}

function renderCalendar(year, month, mData) {
    const grid = document.getElementById('calendar-grid');
    grid.innerHTML = '';
    const weeks = ['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­'];
    weeks.forEach(w => grid.innerHTML += `<div class="cal-day cal-header">${w}</div>`);
    const firstDay = new Date(year, month, 1).getDay();
    const lastDate = new Date(year, month + 1, 0).getDate();
    for (let i = 0; i < firstDay; i++) grid.innerHTML += `<div class="cal-day"></div>`;
    for (let day = 1; day <= lastDate; day++) {
        const fullDate = `${year}-${String(month+1).padStart(2,'0')}-${String(day).padStart(2,'0')}`;
        const dayOrders = mData.filter(r => r[3] === fullDate);
        const cell = document.createElement('div');
        cell.className = `cal-day ${dayOrders.length > 0 ? 'has-order' : ''}`;
        cell.innerText = day;
        if (dayOrders.length > 0) cell.onclick = () => showOrderDetail(dayOrders[0]);
        grid.appendChild(cell);
    }
}

function showOrderDetail(order) {
    const [id, source, name, date, type, guests, rooms, total, dep, bal] = order;
    document.getElementById('modal-body').innerHTML = `
        <h3 style="border:none; padding:0;">${name} (${source})</h3>
        <hr>
        <p><b>å…¥ä½æ—¥æœŸï¼š</b>${date}</p>
        <p><b>å…¥ä½äººæ•¸ï¼š</b>${guests}äºº</p>
        <p><b>ç¸½æˆ¿åƒ¹ï¼š</b>$${total}</p>
        <p><b>å·²æ”¶è¨‚é‡‘ï¼š</b>$${dep}</p>
        <p style="color:red; font-size:1.2rem;"><b>ç¾å ´æ”¶å°¾æ¬¾ï¼š$${bal}</b></p>
        <button class="copy-btn" onclick="location.href='${source==='Booking'?'bookingpulse://':'line://'}'">é–‹å•Ÿè¯ç¹« App</button>
    `;
    document.getElementById('order-modal').style.display = 'block';
}

function closeModal(e) { 
    if(!e || e.target === document.getElementById('order-modal') || e.target.tagName === 'SPAN') {
        document.getElementById('order-modal').style.display = 'none'; 
    }
}

function updateStatistics(mData) {
    const totalG = mData.reduce((s, r) => s + (parseInt(r[5]) || 0), 0);
    const bCount = mData.filter(r => r[1] === 'Booking').length;
    document.getElementById('stat-total-guests').innerText = totalG;
    document.getElementById('stat-b-rate').innerText = (mData.length ? Math.round((bCount/mData.length)*100) : 0) + '%';
}

function toggleStats() {
    const s = document.getElementById('stats-area');
    s.classList.toggle('stats-hidden');
    s.classList.toggle('stats-active');
}

function changeMonth(n) { currentViewDate.setMonth(currentViewDate.getMonth() + n); renderOrderList(); }

function copyText(id, e) {
    const t = document.getElementById(id).innerText;
    navigator.clipboard.writeText(t);
    const btn = e.currentTarget;
    const old = btn.innerText;
    btn.innerText = "âœ… å·²è¤‡è£½æˆåŠŸ";
    setTimeout(() => btn.innerText = old, 1000);
}

window.onload = () => { updateAll(); };
</script>

</body>
</html>
